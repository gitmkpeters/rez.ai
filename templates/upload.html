<!-- Update templates/upload.html -->
{% extends "base.html" %}

{% block title %}Upload Resume - Rez.ai{% endblock %}

{% block content %}
<div class="form-container">
    <h1>Tailor Your Resume</h1>
    <p>Upload your resume and provide a job description to get a tailored version.</p>
    
    <form id="resume-form" action="{{ url_for('main.generate') }}" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="resume_file">Upload Resume (PDF, DOCX, or TXT)</label>
            <input type="file" name="resume_file" id="resume_file" accept=".pdf,.docx,.txt" required>
        </div>
        
        <div class="form-group">
            <label>Job Description</label>
            <div class="input-toggle">
                <label>
                    <input type="radio" name="input_type" value="text" checked> Enter Text
                </label>
                <label>
                    <input type="radio" name="input_type" value="url"> Enter URL
                </label>
            </div>
            
            <div id="text-input-container">
                <textarea name="job_description" id="job_description" placeholder="Paste the job description here..."></textarea>
            </div>
            
            <div id="url-input-container" style="display:none;">
                <input type="url" name="job_url" id="job_url" placeholder="https://www.linkedin.com/jobs/view/123456789">
                <div class="url-hint">Supports LinkedIn, Indeed, Glassdoor, ZipRecruiter, Monster, and most job posting sites</div>
            </div>
        </div>
        
        <button type="submit" id="submit-btn" class="btn">Generate Tailored Resume</button>
    </form>
    
    <div id="loading" class="loading-container" style="display:none;">
        <div class="loading-spinner"></div>
        <p>Processing your resume...</p>
        <p class="loading-step">Analyzing job description...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Toggle between text and URL input
    document.querySelectorAll('input[name="input_type"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const textContainer = document.getElementById('text-input-container');
            const urlContainer = document.getElementById('url-input-container');
            const textArea = document.getElementById('job_description');
            const urlInput = document.getElementById('job_url');
            
            if (this.value === 'text') {
                textContainer.style.display = 'block';
                urlContainer.style.display = 'none';
                textArea.required = true;
                urlInput.required = false;
            } else {
                textContainer.style.display = 'none';
                urlContainer.style.display = 'block';
                textArea.required = false;
                urlInput.required = true;
            }
        });
    });
    
    // Show loading state on form submit
    document.getElementById('resume-form').addEventListener('submit', function(e) {
        // Validate form
        const form = this;
        const inputType = form.querySelector('input[name="input_type"]:checked').value;
        const resumeFile = form.querySelector('#resume_file').files[0];
        
        if (!resumeFile) {
            e.preventDefault();
            alert('Please select a resume file');
            return;
        }
        
        if (inputType === 'text' && !form.querySelector('#job_description').value.trim()) {
            e.preventDefault();
            alert('Please enter a job description');
            return;
        }
        
        if (inputType === 'url' && !form.querySelector('#job_url').value.trim()) {
            e.preventDefault();
            alert('Please enter a job URL');
            return;
        }
        
        // Show loading state
        document.getElementById('resume-form').style.display = 'none';
        document.getElementById('loading').style.display = 'flex';
        
        // Simulate progress updates
        const loadingStep = document.querySelector('.loading-step');
        const steps = [
            'Extracting job description...',
            'Analyzing your resume...',
            'Tailoring content with AI...',
            'Generating PDF document...',
            'Almost done...'
        ];
        
        let stepIndex = 0;
        const stepInterval = setInterval(() => {
            if (stepIndex < steps.length) {
                loadingStep.textContent = steps[stepIndex];
                stepIndex++;
            } else {
                clearInterval(stepInterval);
            }
        }, 3000);
    });
</script>
{% endblock %}